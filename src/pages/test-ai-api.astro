---
// AI API æµ‹è¯•é¡µé¢
---

<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI API é›†æˆæµ‹è¯•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      color: white;
      margin-bottom: 40px;
    }
    
    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    
    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }
    
    .test-section {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .test-section h2 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }
    
    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      font-weight: 600;
      margin-left: 10px;
    }
    
    .status.success {
      background: #10b981;
      color: white;
    }
    
    .status.error {
      background: #ef4444;
      color: white;
    }
    
    .status.running {
      background: #f59e0b;
      color: white;
    }
    
    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    button:hover {
      transform: translateY(-2px);
    }
    
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .data-display {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .result {
      margin-top: 20px;
    }
    
    .result-item {
      padding: 10px;
      border-left: 4px solid #667eea;
      background: #f8fafc;
      margin: 10px 0;
    }
    
    .result-item strong {
      color: #667eea;
    }
    
    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    
    .metric-card {
      background: #f8fafc;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    
    .metric-value {
      font-size: 2rem;
      font-weight: bold;
      color: #667eea;
    }
    
    .metric-label {
      color: #64748b;
      font-size: 0.9rem;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ§ª AI API é›†æˆæµ‹è¯•</h1>
      <p>éªŒè¯æ‰€æœ‰æ•°æ®çœŸå®ä¼ é€’ç»™ AI å¹¶è¿”å›çœŸå®ç»“æœ</p>
    </div>
    
    <!-- æµ‹è¯•æ•°æ®å±•ç¤º -->
    <div class="test-section">
      <h2>ğŸ“Š æµ‹è¯•æ•°æ®</h2>
      <div class="data-display" id="testData"></div>
    </div>
    
    <!-- é€šä¹‰åƒé—®æµ‹è¯• -->
    <div class="test-section">
      <h2>
        ğŸ”µ é€šä¹‰åƒé—® 3.5-Max
        <span class="status" id="qwenStatus">ç­‰å¾…æµ‹è¯•</span>
      </h2>
      <button onclick="testQwen()" id="qwenButton">å¼€å§‹æµ‹è¯•</button>
      
      <div class="metrics" id="qwenMetrics" style="display: none;">
        <div class="metric-card">
          <div class="metric-value" id="qwenTime">-</div>
          <div class="metric-label">å“åº”æ—¶é—´ (ms)</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="qwenConfidence">-</div>
          <div class="metric-label">ç½®ä¿¡åº¦</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="qwenTarget">-</div>
          <div class="metric-label">ç›®æ ‡ä»·æ ¼</div>
        </div>
      </div>
      
      <div class="result" id="qwenResult"></div>
    </div>
    
    <!-- è±†åŒ…æµ‹è¯• -->
    <div class="test-section">
      <h2>
        ğŸŸ¢ è±†åŒ…
        <span class="status" id="doubaoStatus">ç­‰å¾…æµ‹è¯•</span>
      </h2>
      <button onclick="testDoubao()" id="doubaoButton">å¼€å§‹æµ‹è¯•</button>
      
      <div class="metrics" id="doubaoMetrics" style="display: none;">
        <div class="metric-card">
          <div class="metric-value" id="doubaoTime">-</div>
          <div class="metric-label">å“åº”æ—¶é—´ (ms)</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="doubaoConfidence">-</div>
          <div class="metric-label">ç½®ä¿¡åº¦</div>
        </div>
        <div class="metric-card">
          <div class="metric-value" id="doubaoTarget">-</div>
          <div class="metric-label">ç›®æ ‡ä»·æ ¼</div>
        </div>
      </div>
      
      <div class="result" id="doubaoResult"></div>
    </div>
  </div>
  
  <script>
    // æµ‹è¯•æ•°æ®
    const testData = {
      currentPrice: 618.5,
      openPrice: 615.0,
      high: 620.0,
      low: 614.0,
      changePercent: 0.57,
      priceHistory: [
        { timestamp: Date.now() - 3600000, price: 615.0 },
        { timestamp: Date.now() - 1800000, price: 616.5 },
        { timestamp: Date.now() - 900000, price: 617.0 },
        { timestamp: Date.now() - 600000, price: 618.0 },
        { timestamp: Date.now() - 300000, price: 618.5 }
      ]
    };
    
    // æ˜¾ç¤ºæµ‹è¯•æ•°æ®
    document.getElementById('testData').textContent = JSON.stringify(testData, null, 2);
    
    // æ„å»ºæç¤ºè¯
    function buildPrompt() {
      const priceList = testData.priceHistory
        .map(p => `${new Date(p.timestamp).toLocaleTimeString('zh-CN')}: Â¥${p.price.toFixed(2)}`)
        .join('\n');
      
      return `ã€å¸‚åœºæ•°æ®ã€‘
å½“å‰ä»·æ ¼ï¼šÂ¥${testData.currentPrice}/å…‹
ä»Šæ—¥å¼€ç›˜ï¼šÂ¥${testData.openPrice}/å…‹
ä»Šæ—¥æœ€é«˜ï¼šÂ¥${testData.high}/å…‹
ä»Šæ—¥æœ€ä½ï¼šÂ¥${testData.low}/å…‹
æ—¥å†…æ¶¨è·Œï¼š${testData.changePercent.toFixed(2)}%

ã€è¿‘æœŸä»·æ ¼èµ°åŠ¿ã€‘
${priceList}

ã€æŠ€æœ¯æŒ‡æ ‡ã€‘
RSI: 55.2 (neutral)
MACD: 0.35 (buy)
Bollinger: 0.65 (neutral)
MA Cross: 0.2 (buy)

ã€è¶‹åŠ¿åˆ†æã€‘
å½“å‰è¶‹åŠ¿ï¼šup
è¶‹åŠ¿å¼ºåº¦ï¼š6.5
æ³¢åŠ¨ç‡ï¼š1.8%
æ”¯æ’‘ä½ï¼šÂ¥614.00
é˜»åŠ›ä½ï¼šÂ¥620.00

è¯·åˆ†æä»¥ä¸Šæ•°æ®å¹¶æä¾›ï¼š
1. çŸ­æœŸä»·æ ¼é¢„æµ‹ (1-4 å°æ—¶)
2. ä¸­æœŸä»·æ ¼é¢„æµ‹ (1-3 å¤©)
3. è¶‹åŠ¿åˆ¤æ–­åŠç½®ä¿¡åº¦
4. å…³é”®é£é™©å› ç´ 
5. äº¤æ˜“å»ºè®®

è¯·ä»¥ JSON æ ¼å¼è¿”å›ï¼š
{
  "direction": "bullish/bearish/neutral",
  "confidence": 0.0-1.0,
  "shortTermTarget": ç›®æ ‡ä»·æ ¼ï¼Œ
  "midTermTarget": ç›®æ ‡ä»·æ ¼ï¼Œ
  "factors": ["å› ç´  1", "å› ç´  2", "å› ç´  3"],
  "risk": "low/medium/high",
  "maxDrawdown": æ•°å€¼ï¼Œ
  "volatility": æ•°å€¼
}`;
    }
    
    // æµ‹è¯•é€šä¹‰åƒé—®
    async function testQwen() {
      const button = document.getElementById('qwenButton');
      const status = document.getElementById('qwenStatus');
      const metrics = document.getElementById('qwenMetrics');
      const resultDiv = document.getElementById('qwenResult');
      
      button.disabled = true;
      status.textContent = 'æµ‹è¯•ä¸­...';
      status.className = 'status running';
      metrics.style.display = 'none';
      resultDiv.innerHTML = '';
      
      const startTime = Date.now();
      
      try {
        const response = await fetch('/api/test-qwen', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: buildPrompt() })
        });
        
        const elapsed = Date.now() - startTime;
        const data = await response.json();
        
        if (response.ok && data.success) {
          status.textContent = 'âœ… æˆåŠŸ';
          status.className = 'status success';
          
          // æ˜¾ç¤ºæŒ‡æ ‡
          document.getElementById('qwenTime').textContent = elapsed;
          document.getElementById('qwenConfidence').textContent = data.confidence?.toFixed(2) || '-';
          document.getElementById('qwenTarget').textContent = data.targetPrice || '-';
          metrics.style.display = 'grid';
          
          // æ˜¾ç¤ºç»“æœ
          resultDiv.innerHTML = `
            <div class="result-item">
              <strong>â±ï¸ å“åº”æ—¶é—´:</strong> ${elapsed}ms
            </div>
            <div class="result-item">
              <strong>ğŸ“¡ çŠ¶æ€ç :</strong> ${response.status}
            </div>
            <div class="result-item">
              <strong>ğŸ¤– AI å›å¤:</strong>
              <div class="data-display">${data.rawResponse || 'æ— '}</div>
            </div>
            <div class="result-item">
              <strong>ğŸ“Š è§£æç»“æœ:</strong>
              <div class="data-display">${JSON.stringify(data.parsed, null, 2)}</div>
            </div>
          `;
        } else {
          throw new Error(data.error || 'æµ‹è¯•å¤±è´¥');
        }
      } catch (error) {
        status.textContent = 'âŒ å¤±è´¥';
        status.className = 'status error';
        resultDiv.innerHTML = `
          <div class="result-item" style="border-left-color: #ef4444;">
            <strong>âŒ é”™è¯¯:</strong> ${error.message}
          </div>
        `;
      } finally {
        button.disabled = false;
      }
    }
    
    // æµ‹è¯•è±†åŒ…
    async function testDoubao() {
      const button = document.getElementById('doubaoButton');
      const status = document.getElementById('doubaoStatus');
      const metrics = document.getElementById('doubaoMetrics');
      const resultDiv = document.getElementById('doubaoResult');
      
      button.disabled = true;
      status.textContent = 'æµ‹è¯•ä¸­...';
      status.className = 'status running';
      metrics.style.display = 'none';
      resultDiv.innerHTML = '';
      
      const startTime = Date.now();
      
      try {
        const response = await fetch('/api/test-doubao', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt: buildPrompt() })
        });
        
        const elapsed = Date.now() - startTime;
        const data = await response.json();
        
        if (response.ok && data.success) {
          status.textContent = 'âœ… æˆåŠŸ';
          status.className = 'status success';
          
          // æ˜¾ç¤ºæŒ‡æ ‡
          document.getElementById('doubaoTime').textContent = elapsed;
          document.getElementById('doubaoConfidence').textContent = data.confidence?.toFixed(2) || '-';
          document.getElementById('doubaoTarget').textContent = data.targetPrice || '-';
          metrics.style.display = 'grid';
          
          // æ˜¾ç¤ºç»“æœ
          resultDiv.innerHTML = `
            <div class="result-item">
              <strong>â±ï¸ å“åº”æ—¶é—´:</strong> ${elapsed}ms
            </div>
            <div class="result-item">
              <strong>ğŸ“¡ çŠ¶æ€ç :</strong> ${response.status}
            </div>
            <div class="result-item">
              <strong>ğŸ¤– AI å›å¤:</strong>
              <div class="data-display">${data.rawResponse || 'æ— '}</div>
            </div>
            <div class="result-item">
              <strong>ğŸ“Š è§£æç»“æœ:</strong>
              <div class="data-display">${JSON.stringify(data.parsed, null, 2)}</div>
            </div>
          `;
        } else {
          throw new Error(data.error || 'æµ‹è¯•å¤±è´¥');
        }
      } catch (error) {
        status.textContent = 'âŒ å¤±è´¥';
        status.className = 'status error';
        resultDiv.innerHTML = `
          <div class="result-item" style="border-left-color: #ef4444;">
            <strong>âŒ é”™è¯¯:</strong> ${error.message}
          </div>
        `;
      } finally {
        button.disabled = false;
      }
    }
  </script>
</body>
</html>
