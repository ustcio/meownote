---
import Layout from '@layouts/Layout.astro';

const lang = Astro.url.pathname.startsWith('/zh') ? 'zh' : 'en';

const tools = [
  {
    id: 'doi',
    icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line></svg>`,
    title: lang === 'zh' ? 'DOI 引用转换' : 'DOI Citation Converter',
    desc: lang === 'zh' ? '将DOI转换为多种引用格式' : 'Convert DOI to multiple citation formats'
  },
  {
    id: 'bibtex',
    icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"></polyline><polyline points="8 6 2 12 8 18"></polyline></svg>`,
    title: 'BibTeX 生成器',
    desc: lang === 'zh' ? '生成标准BibTeX格式' : 'Generate standard BibTeX format'
  },
  {
    id: 'impact',
    icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>`,
    title: lang === 'zh' ? '期刊影响因子' : 'Journal Impact Factor',
    desc: lang === 'zh' ? '查询期刊影响因子和分区' : 'Query journal impact factor and ranking'
  },
  {
    id: 'latex',
    icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>`,
    title: 'LaTeX 公式',
    desc: lang === 'zh' ? '在线编辑LaTeX数学公式' : 'Online LaTeX equation editor'
  },
  {
    id: 'translate',
    icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 8l6 6"></path><path d="M4 14l6-6 2-3"></path><path d="M2 5h12"></path><path d="M7 2h1"></path><path d="M22 22l-5-10-5 10"></path><path d="M14 18h6"></path></svg>`,
    title: lang === 'zh' ? '学术翻译' : 'Academic Translation',
    desc: lang === 'zh' ? '专业学术文献翻译' : 'Professional academic translation'
  },
  {
    id: 'keywords',
    icon: `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>`,
    title: lang === 'zh' ? '关键词提取' : 'Keyword Extractor',
    desc: lang === 'zh' ? '从文本中提取关键词' : 'Extract keywords from text'
  }
];

const citationFormats = [
  { id: 'apa', name: 'APA 7th', example: 'Author, A. A. (Year). Title. Journal, Volume(Issue), Pages.' },
  { id: 'mla', name: 'MLA 9th', example: 'Author, A. A. "Title." Journal, vol. X, no. X, Year, pp. XX-XX.' },
  { id: 'chicago', name: 'Chicago', example: 'Author, A. A. "Title." Journal X, no. X (Year): XX-XX.' },
  { id: 'ieee', name: 'IEEE', example: 'A. A. Author, "Title," Journal, vol. X, no. X, pp. XX-XX, Year.' },
  { id: 'vancouver', name: 'Vancouver', example: 'Author AA. Title. Journal. Year;Volume(Issue):Pages.' },
  { id: 'bibtex', name: 'BibTeX', example: '@article{key, author={...}, title={...}, ...}' },
  { id: 'gbt7714', name: 'GB/T 7714', example: '作者. 题名[J]. 刊名, 年, 卷(期): 起止页码.' }
];
---

<Layout 
  title={lang === 'zh' ? '学术工具 - Meow Note' : 'Academic Tools - Meow Note'}
  description={lang === 'zh' ? '学术研究工具集' : 'Academic research tools'}
>
  <section class="academic">
    <div class="academic-container">
      <header class="page-header">
        <h1 class="page-title">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
          </svg>
          {lang === 'zh' ? '学术工具箱' : 'Academic Toolkit'}
        </h1>
        <p class="page-subtitle">{lang === 'zh' ? '为学术研究提供便捷工具' : 'Convenient tools for academic research'}</p>
      </header>
      
      <div class="tools-grid">
        {tools.map(tool => (
          <button class="tool-card" data-tool={tool.id}>
            <div class="tool-icon">{tool.icon}</div>
            <div class="tool-info">
              <h3 class="tool-title">{tool.title}</h3>
              <p class="tool-desc">{tool.desc}</p>
            </div>
            <svg class="tool-arrow" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        ))}
      </div>
      
      <!-- DOI Citation Tool -->
      <div class="tool-panel" id="panel-doi">
        <div class="panel-header">
          <button class="back-btn" data-back>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <h2 class="panel-title">{lang === 'zh' ? 'DOI 引用转换' : 'DOI Citation Converter'}</h2>
        </div>
        
        <div class="panel-content">
          <div class="input-section">
            <label class="input-label">{lang === 'zh' ? '输入 DOI' : 'Enter DOI'}</label>
            <div class="doi-input-group">
              <span class="doi-prefix">https://doi.org/</span>
              <input type="text" id="doi-input" placeholder="10.1000/xyz123" />
            </div>
            <button class="fetch-btn" id="fetch-doi">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
              <span>{lang === 'zh' ? '获取引用' : 'Fetch Citation'}</span>
            </button>
          </div>
          
          <div class="result-section hidden" id="doi-result">
            <div class="article-info" id="article-info">
              <h3 class="article-title" id="article-title"></h3>
              <p class="article-authors" id="article-authors"></p>
              <p class="article-journal" id="article-journal"></p>
              <div class="article-meta">
                <span class="meta-item" id="article-date"></span>
                <span class="meta-item" id="article-doi"></span>
              </div>
            </div>
            
            <div class="format-tabs">
              {citationFormats.map(format => (
                <button class="format-tab" data-format={format.id}>{format.name}</button>
              ))}
            </div>
            
            <div class="citation-output">
              <div class="output-header">
                <span class="output-label">{lang === 'zh' ? '引用格式' : 'Citation Format'}</span>
                <button class="copy-btn" id="copy-citation">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                  <span>{lang === 'zh' ? '复制' : 'Copy'}</span>
                </button>
              </div>
              <pre class="citation-text" id="citation-text"></pre>
            </div>
            
            <div class="online-info">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
              </svg>
              <span>{lang === 'zh' ? '在线时间：' : 'Online since: '}</span>
              <span id="online-date"></span>
            </div>
          </div>
          
          <div class="error-message hidden" id="doi-error">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            <span id="error-text"></span>
          </div>
        </div>
      </div>
      
      <!-- BibTeX Generator -->
      <div class="tool-panel" id="panel-bibtex">
        <div class="panel-header">
          <button class="back-btn" data-back>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <h2 class="panel-title">BibTeX {lang === 'zh' ? '生成器' : 'Generator'}</h2>
        </div>
        
        <div class="panel-content">
          <div class="form-grid">
            <div class="form-group">
              <label>{lang === 'zh' ? '文献类型' : 'Entry Type'}</label>
              <select id="bibtex-type">
                <option value="article">Article (期刊论文)</option>
                <option value="book">Book (书籍)</option>
                <option value="inproceedings">InProceedings (会议论文)</option>
                <option value="phdthesis">PhDThesis (博士论文)</option>
                <option value="mastersthesis">MastersThesis (硕士论文)</option>
                <option value="misc">Misc (其他)</option>
              </select>
            </div>
            <div class="form-group">
              <label>{lang === 'zh' ? '引用键' : 'Citation Key'}</label>
              <input type="text" id="bibtex-key" placeholder="Author2024Title" />
            </div>
            <div class="form-group full-width">
              <label>{lang === 'zh' ? '作者（每行一位）' : 'Authors (one per line)'}</label>
              <textarea id="bibtex-authors" rows="3" placeholder="Last, First"></textarea>
            </div>
            <div class="form-group full-width">
              <label>{lang === 'zh' ? '标题' : 'Title'}</label>
              <input type="text" id="bibtex-title" />
            </div>
            <div class="form-group">
              <label>{lang === 'zh' ? '期刊/出版社' : 'Journal/Publisher'}</label>
              <input type="text" id="bibtex-journal" />
            </div>
            <div class="form-group">
              <label>{lang === 'zh' ? '年份' : 'Year'}</label>
              <input type="text" id="bibtex-year" placeholder="2024" />
            </div>
            <div class="form-group">
              <label>{lang === 'zh' ? '卷' : 'Volume'}</label>
              <input type="text" id="bibtex-volume" />
            </div>
            <div class="form-group">
              <label>{lang === 'zh' ? '期' : 'Number'}</label>
              <input type="text" id="bibtex-number" />
            </div>
            <div class="form-group">
              <label>{lang === 'zh' ? '页码' : 'Pages'}</label>
              <input type="text" id="bibtex-pages" placeholder="1-10" />
            </div>
            <div class="form-group">
              <label>DOI</label>
              <input type="text" id="bibtex-doi" placeholder="10.1000/xyz123" />
            </div>
          </div>
          
          <button class="generate-btn" id="generate-bibtex">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="16 18 22 12 16 6"></polyline>
              <polyline points="8 6 2 12 8 18"></polyline>
            </svg>
            <span>{lang === 'zh' ? '生成 BibTeX' : 'Generate BibTeX'}</span>
          </button>
          
          <div class="bibtex-output hidden" id="bibtex-output">
            <div class="output-header">
              <span class="output-label">BibTeX</span>
              <button class="copy-btn" id="copy-bibtex">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                <span>{lang === 'zh' ? '复制' : 'Copy'}</span>
              </button>
            </div>
            <pre class="bibtex-code" id="bibtex-code"></pre>
          </div>
        </div>
      </div>
      
      <!-- Impact Factor -->
      <div class="tool-panel" id="panel-impact">
        <div class="panel-header">
          <button class="back-btn" data-back>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <h2 class="panel-title">{lang === 'zh' ? '期刊影响因子查询' : 'Journal Impact Factor'}</h2>
        </div>
        
        <div class="panel-content">
          <div class="input-section">
            <label class="input-label">{lang === 'zh' ? '输入期刊名称或ISSN' : 'Enter journal name or ISSN'}</label>
            <input type="text" id="journal-input" placeholder={lang === 'zh' ? '例如：Nature, 0028-0836' : 'e.g., Nature, 0028-0836'} />
            <button class="fetch-btn" id="search-journal">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
              <span>{lang === 'zh' ? '查询' : 'Search'}</span>
            </button>
          </div>
          
          <div class="journal-result hidden" id="journal-result">
            <div class="journal-header">
              <h3 class="journal-name" id="journal-name"></h3>
              <span class="journal-issn" id="journal-issn"></span>
            </div>
            <div class="metrics-grid">
              <div class="metric-card">
                <span class="metric-value" id="impact-factor">--</span>
                <span class="metric-label">{lang === 'zh' ? '影响因子' : 'Impact Factor'}</span>
              </div>
              <div class="metric-card">
                <span class="metric-value" id="jcr-quartile">--</span>
                <span class="metric-label">JCR {lang === 'zh' ? '分区' : 'Quartile'}</span>
              </div>
              <div class="metric-card">
                <span class="metric-value" id="cas-quartile">--</span>
                <span class="metric-label">CAS {lang === 'zh' ? '分区' : 'Quartile'}</span>
              </div>
              <div class="metric-card">
                <span class="metric-value" id="category">--</span>
                <span class="metric-label">{lang === 'zh' ? '学科领域' : 'Category'}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- LaTeX Editor -->
      <div class="tool-panel" id="panel-latex">
        <div class="panel-header">
          <button class="back-btn" data-back>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <h2 class="panel-title">LaTeX {lang === 'zh' ? '公式编辑器' : 'Equation Editor'}</h2>
        </div>
        
        <div class="panel-content">
          <div class="latex-editor">
            <div class="editor-section">
              <label>{lang === 'zh' ? 'LaTeX 代码' : 'LaTeX Code'}</label>
              <textarea id="latex-input" rows="4" placeholder="\frac{-b \pm \sqrt{b^2-4ac}}{2a}"></textarea>
            </div>
            <div class="quick-symbols">
              <button class="symbol-btn" data-latex="\frac{a}{b}">a/b</button>
              <button class="symbol-btn" data-latex="\sqrt{x}">√x</button>
              <button class="symbol-btn" data-latex="x^{n}">xⁿ</button>
              <button class="symbol-btn" data-latex="x_{n}">xₙ</button>
              <button class="symbol-btn" data-latex="\sum_{i=1}^{n}">Σ</button>
              <button class="symbol-btn" data-latex="\int_{a}^{b}">∫</button>
              <button class="symbol-btn" data-latex="\alpha">\alpha</button>
              <button class="symbol-btn" data-latex="\beta">\beta</button>
              <button class="symbol-btn" data-latex="\gamma">\gamma</button>
              <button class="symbol-btn" data-latex="\infty">∞</button>
              <button class="symbol-btn" data-latex="\partial">∂</button>
              <button class="symbol-btn" data-latex="\nabla">∇</button>
            </div>
            <button class="render-btn" id="render-latex">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
              <span>{lang === 'zh' ? '渲染公式' : 'Render Equation'}</span>
            </button>
            <div class="preview-section">
              <label>{lang === 'zh' ? '预览' : 'Preview'}</label>
              <div class="latex-preview" id="latex-preview">
                <span class="placeholder">{lang === 'zh' ? '公式预览将显示在这里' : 'Equation preview will appear here'}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Translation -->
      <div class="tool-panel" id="panel-translate">
        <div class="panel-header">
          <button class="back-btn" data-back>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <h2 class="panel-title">{lang === 'zh' ? '学术翻译' : 'Academic Translation'}</h2>
        </div>
        
        <div class="panel-content">
          <div class="translate-layout">
            <div class="translate-section">
              <div class="section-header">
                <select id="source-lang">
                  <option value="en">English</option>
                  <option value="zh">中文</option>
                  <option value="ja">日本語</option>
                  <option value="auto">{lang === 'zh' ? '自动检测' : 'Auto Detect'}</option>
                </select>
              </div>
              <textarea id="source-text" rows="8" placeholder={lang === 'zh' ? '输入要翻译的文本...' : 'Enter text to translate...'}></textarea>
            </div>
            <div class="translate-actions">
              <button class="swap-btn" id="swap-langs">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="17 1 21 5 17 9"></polyline>
                  <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
                  <polyline points="7 23 3 19 7 15"></polyline>
                  <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
                </svg>
              </button>
              <button class="translate-btn" id="do-translate">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M5 8l6 6"></path>
                  <path d="M4 14l6-6 2-3"></path>
                  <path d="M2 5h12"></path>
                  <path d="M7 2h1"></path>
                  <path d="M22 22l-5-10-5 10"></path>
                  <path d="M14 18h6"></path>
                </svg>
                <span>{lang === 'zh' ? '翻译' : 'Translate'}</span>
              </button>
            </div>
            <div class="translate-section">
              <div class="section-header">
                <select id="target-lang">
                  <option value="zh">中文</option>
                  <option value="en">English</option>
                  <option value="ja">日本語</option>
                </select>
              </div>
              <textarea id="target-text" rows="8" readonly placeholder={lang === 'zh' ? '翻译结果...' : 'Translation result...'}></textarea>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Keywords Extractor -->
      <div class="tool-panel" id="panel-keywords">
        <div class="panel-header">
          <button class="back-btn" data-back>
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
          <h2 class="panel-title">{lang === 'zh' ? '关键词提取' : 'Keyword Extractor'}</h2>
        </div>
        
        <div class="panel-content">
          <div class="input-section">
            <label class="input-label">{lang === 'zh' ? '输入文本（建议100-5000字）' : 'Enter text (100-5000 words recommended)'}</label>
            <textarea id="keyword-text" rows="10" placeholder={lang === 'zh' ? '粘贴您的学术文本...' : 'Paste your academic text...'}></textarea>
            <div class="options-row">
              <label class="option-label">
                <span>{lang === 'zh' ? '关键词数量' : 'Number of keywords'}</span>
                <select id="keyword-count">
                  <option value="5">5</option>
                  <option value="10" selected>10</option>
                  <option value="15">15</option>
                  <option value="20">20</option>
                </select>
              </label>
            </div>
            <button class="fetch-btn" id="extract-keywords">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg>
              <span>{lang === 'zh' ? '提取关键词' : 'Extract Keywords'}</span>
            </button>
          </div>
          
          <div class="keywords-result hidden" id="keywords-result">
            <label class="input-label">{lang === 'zh' ? '提取结果' : 'Extracted Keywords'}</label>
            <div class="keywords-cloud" id="keywords-cloud"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
</Layout>

<style>
  .academic {
    min-height: 100vh;
    padding: calc(var(--header-height) + var(--space-8)) var(--space-4) var(--space-12);
  }
  
  .academic-container {
    max-width: var(--container-lg);
    margin: 0 auto;
  }
  
  .page-header {
    text-align: center;
    margin-bottom: var(--space-8);
  }
  
  .page-title {
    display: inline-flex;
    align-items: center;
    gap: var(--space-3);
    font-size: var(--text-2xl);
    font-weight: var(--font-bold);
    color: var(--text-primary);
    margin-bottom: var(--space-2);
  }
  
  .page-title svg {
    color: var(--color-accent-blue);
  }
  
  .page-subtitle {
    color: var(--text-secondary);
    font-size: var(--text-base);
  }
  
  .tools-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--space-4);
  }
  
  .tool-card {
    display: flex;
    align-items: center;
    gap: var(--space-4);
    padding: var(--space-5);
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: var(--radius-xl);
    text-align: left;
    transition: all 0.2s ease;
  }
  
  .tool-card:hover {
    border-color: var(--color-accent-blue);
    transform: translateY(-2px);
    box-shadow: var(--shadow-float);
  }
  
  .tool-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, var(--color-accent-blue), var(--color-accent-purple));
    border-radius: var(--radius-lg);
    color: white;
    flex-shrink: 0;
  }
  
  .tool-info {
    flex: 1;
    min-width: 0;
  }
  
  .tool-title {
    font-size: var(--text-base);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    margin-bottom: var(--space-1);
  }
  
  .tool-desc {
    font-size: var(--text-sm);
    color: var(--text-tertiary);
  }
  
  .tool-arrow {
    color: var(--text-tertiary);
    transition: transform 0.2s ease;
  }
  
  .tool-card:hover .tool-arrow {
    transform: translateX(4px);
    color: var(--color-accent-blue);
  }
  
  .tool-panel {
    display: none;
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    border-radius: var(--radius-2xl);
    overflow: hidden;
  }
  
  .tool-panel.active {
    display: block;
  }
  
  .panel-header {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4) var(--space-5);
    border-bottom: 1px solid var(--border-primary);
  }
  
  .back-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    color: var(--text-secondary);
    transition: all 0.15s ease;
  }
  
  .back-btn:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }
  
  .panel-title {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
  }
  
  .panel-content {
    padding: var(--space-5);
  }
  
  .input-section {
    margin-bottom: var(--space-5);
  }
  
  .input-label {
    display: block;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--text-secondary);
    margin-bottom: var(--space-2);
  }
  
  .doi-input-group {
    display: flex;
    margin-bottom: var(--space-3);
  }
  
  .doi-prefix {
    display: flex;
    align-items: center;
    padding: 0 var(--space-3);
    background: var(--bg-tertiary);
    border: 1px solid var(--border-primary);
    border-right: none;
    border-radius: var(--radius-lg) 0 0 var(--radius-lg);
    color: var(--text-tertiary);
    font-size: var(--text-sm);
  }
  
  .doi-input-group input {
    flex: 1;
    padding: var(--space-3);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
    color: var(--text-primary);
    font-size: var(--text-base);
  }
  
  .doi-input-group input:focus {
    outline: none;
    border-color: var(--color-accent-blue);
  }
  
  .fetch-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-5);
    background: linear-gradient(135deg, var(--color-accent-blue), var(--color-accent-purple));
    border-radius: var(--radius-lg);
    color: white;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    transition: all 0.15s ease;
  }
  
  .fetch-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
  }
  
  .result-section {
    margin-top: var(--space-5);
    padding-top: var(--space-5);
    border-top: 1px solid var(--border-primary);
  }
  
  .result-section.hidden {
    display: none;
  }
  
  .article-info {
    margin-bottom: var(--space-4);
  }
  
  .article-title {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
    margin-bottom: var(--space-2);
    line-height: 1.4;
  }
  
  .article-authors {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    margin-bottom: var(--space-1);
  }
  
  .article-journal {
    font-size: var(--text-sm);
    color: var(--text-tertiary);
    font-style: italic;
  }
  
  .article-meta {
    display: flex;
    gap: var(--space-4);
    margin-top: var(--space-2);
  }
  
  .meta-item {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
  }
  
  .format-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-bottom: var(--space-3);
  }
  
  .format-tab {
    padding: var(--space-2) var(--space-3);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    color: var(--text-secondary);
    transition: all 0.15s ease;
  }
  
  .format-tab:hover {
    background: var(--bg-tertiary);
  }
  
  .format-tab.active {
    background: var(--color-accent-blue);
    border-color: var(--color-accent-blue);
    color: white;
  }
  
  .citation-output {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    overflow: hidden;
  }
  
  .output-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-2) var(--space-3);
    background: var(--bg-tertiary);
    border-bottom: 1px solid var(--border-primary);
  }
  
  .output-label {
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    color: var(--text-tertiary);
  }
  
  .copy-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-1);
    font-size: var(--text-xs);
    color: var(--text-secondary);
    transition: color 0.15s ease;
  }
  
  .copy-btn:hover {
    color: var(--color-accent-blue);
  }
  
  .citation-text {
    padding: var(--space-4);
    font-size: var(--text-sm);
    color: var(--text-primary);
    white-space: pre-wrap;
    word-break: break-word;
    line-height: 1.6;
    margin: 0;
    font-family: inherit;
  }
  
  .online-info {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    margin-top: var(--space-3);
    font-size: var(--text-xs);
    color: var(--text-tertiary);
  }
  
  .error-message {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3);
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: var(--radius-lg);
    color: #ef4444;
    font-size: var(--text-sm);
  }
  
  .error-message.hidden {
    display: none;
  }
  
  .form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-4);
    margin-bottom: var(--space-4);
  }
  
  .form-group {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }
  
  .form-group.full-width {
    grid-column: 1 / -1;
  }
  
  .form-group label {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--text-secondary);
  }
  
  .form-group input,
  .form-group textarea,
  .form-group select {
    padding: var(--space-3);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    color: var(--text-primary);
    font-size: var(--text-sm);
    transition: border-color 0.15s ease;
  }
  
  .form-group input:focus,
  .form-group textarea:focus,
  .form-group select:focus {
    outline: none;
    border-color: var(--color-accent-blue);
  }
  
  .generate-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-5);
    background: linear-gradient(135deg, var(--color-accent-blue), var(--color-accent-purple));
    border-radius: var(--radius-lg);
    color: white;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    margin-bottom: var(--space-4);
    transition: all 0.15s ease;
  }
  
  .generate-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
  }
  
  .bibtex-output {
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    overflow: hidden;
  }
  
  .bibtex-output.hidden {
    display: none;
  }
  
  .bibtex-code {
    padding: var(--space-4);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--text-primary);
    white-space: pre;
    overflow-x: auto;
    margin: 0;
  }
  
  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-4);
    margin-top: var(--space-4);
  }
  
  @media (max-width: 768px) {
    .metrics-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
  
  .metric-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: var(--space-4);
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    text-align: center;
  }
  
  .metric-value {
    font-size: var(--text-xl);
    font-weight: var(--font-bold);
    color: var(--text-primary);
    margin-bottom: var(--space-1);
  }
  
  .metric-label {
    font-size: var(--text-xs);
    color: var(--text-tertiary);
  }
  
  .journal-result.hidden {
    display: none;
  }
  
  .journal-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: var(--space-4);
    margin-bottom: var(--space-4);
  }
  
  .journal-name {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--text-primary);
  }
  
  .journal-issn {
    font-size: var(--text-sm);
    color: var(--text-tertiary);
  }
  
  .latex-editor {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }
  
  .editor-section label {
    display: block;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--text-secondary);
    margin-bottom: var(--space-2);
  }
  
  .editor-section textarea {
    width: 100%;
    padding: var(--space-3);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    color: var(--text-primary);
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    resize: vertical;
  }
  
  .editor-section textarea:focus {
    outline: none;
    border-color: var(--color-accent-blue);
  }
  
  .quick-symbols {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }
  
  .symbol-btn {
    padding: var(--space-2) var(--space-3);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-md);
    font-size: var(--text-sm);
    font-family: var(--font-mono);
    color: var(--text-secondary);
    transition: all 0.15s ease;
  }
  
  .symbol-btn:hover {
    background: var(--bg-tertiary);
    border-color: var(--color-accent-blue);
    color: var(--text-primary);
  }
  
  .render-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-5);
    background: linear-gradient(135deg, var(--color-accent-blue), var(--color-accent-purple));
    border-radius: var(--radius-lg);
    color: white;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    transition: all 0.15s ease;
  }
  
  .render-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
  }
  
  .preview-section label {
    display: block;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--text-secondary);
    margin-bottom: var(--space-2);
  }
  
  .latex-preview {
    min-height: 100px;
    padding: var(--space-4);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .latex-preview .placeholder {
    color: var(--text-tertiary);
    font-size: var(--text-sm);
  }
  
  .translate-layout {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: var(--space-4);
    align-items: start;
  }
  
  @media (max-width: 768px) {
    .translate-layout {
      grid-template-columns: 1fr;
    }
  }
  
  .translate-section {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }
  
  .section-header {
    display: flex;
    justify-content: flex-end;
  }
  
  .section-header select {
    padding: var(--space-2) var(--space-3);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    color: var(--text-primary);
    font-size: var(--text-sm);
  }
  
  .translate-section textarea {
    width: 100%;
    padding: var(--space-3);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-lg);
    color: var(--text-primary);
    font-size: var(--text-sm);
    resize: vertical;
  }
  
  .translate-section textarea:focus {
    outline: none;
    border-color: var(--color-accent-blue);
  }
  
  .translate-actions {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    align-items: center;
    padding-top: var(--space-8);
  }
  
  .swap-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-full);
    color: var(--text-secondary);
    transition: all 0.15s ease;
  }
  
  .swap-btn:hover {
    background: var(--bg-tertiary);
    color: var(--text-primary);
  }
  
  .translate-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-4);
    background: linear-gradient(135deg, var(--color-accent-blue), var(--color-accent-purple));
    border-radius: var(--radius-lg);
    color: white;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    transition: all 0.15s ease;
  }
  
  .translate-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
  }
  
  .options-row {
    display: flex;
    gap: var(--space-4);
    margin-bottom: var(--space-3);
  }
  
  .option-label {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--text-secondary);
  }
  
  .option-label select {
    padding: var(--space-2) var(--space-3);
    background: var(--bg-secondary);
    border: 1px solid var(--border-primary);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-size: var(--text-sm);
  }
  
  .keywords-result.hidden {
    display: none;
  }
  
  .keywords-cloud {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
    margin-top: var(--space-2);
  }
  
  .keyword-tag {
    padding: var(--space-2) var(--space-3);
    background: linear-gradient(135deg, var(--color-accent-blue), var(--color-accent-purple));
    border-radius: var(--radius-full);
    color: white;
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
  }
</style>

<script>
  const API_BASE = 'https://api.agiera.net';
  const lang = document.documentElement.lang === 'zh' ? 'zh' : 'en';
  
  const toolsGrid = document.querySelector('.tools-grid');
  const toolPanels = document.querySelectorAll('.tool-panel');
  const toolCards = document.querySelectorAll('.tool-card');
  const backBtns = document.querySelectorAll('[data-back]');
  
  let currentArticle: any = null;
  let currentFormat = 'apa';
  
  function showPanel(toolId: string) {
    toolsGrid?.classList.add('hidden');
    toolPanels.forEach(panel => {
      panel.classList.toggle('active', panel.id === `panel-${toolId}`);
    });
  }
  
  function hidePanel() {
    toolPanels.forEach(panel => panel.classList.remove('active'));
    toolsGrid?.classList.remove('hidden');
  }
  
  toolCards.forEach(card => {
    card.addEventListener('click', () => {
      const toolId = card.getAttribute('data-tool');
      if (toolId) showPanel(toolId);
    });
  });
  
  backBtns.forEach(btn => {
    btn.addEventListener('click', hidePanel);
  });
  
  // DOI Citation Tool
  const fetchDoiBtn = document.getElementById('fetch-doi');
  const doiInput = document.getElementById('doi-input') as HTMLInputElement;
  const doiResult = document.getElementById('doi-result');
  const doiError = document.getElementById('doi-error');
  
  fetchDoiBtn?.addEventListener('click', async () => {
    const doi = doiInput?.value.trim();
    if (!doi) return;
    
    doiResult?.classList.add('hidden');
    doiError?.classList.add('hidden');
    
    try {
      const response = await fetch(`https://api.crossref.org/works/${encodeURIComponent(doi)}`);
      const data = await response.json();
      
      if (data.status === 'ok' && data.message) {
        currentArticle = data.message;
        displayArticle(currentArticle);
        doiResult?.classList.remove('hidden');
      } else {
        showError(lang === 'zh' ? '未找到该DOI对应的文献' : 'DOI not found');
      }
    } catch (error) {
      showError(lang === 'zh' ? '获取DOI信息失败，请检查DOI是否正确' : 'Failed to fetch DOI. Please check if the DOI is correct.');
    }
  });
  
  function showError(message: string) {
    const errorText = document.getElementById('error-text');
    if (errorText) errorText.textContent = message;
    doiError?.classList.remove('hidden');
  }
  
  function displayArticle(article: any) {
    const title = article.title?.[0] || 'Unknown Title';
    const authors = article.author?.map((a: any) => `${a.family}, ${a.given}`).join('; ') || 'Unknown Authors';
    const journal = article['container-title']?.[0] || article['short-container-title']?.[0] || '';
    const year = article.published?.['date-parts']?.[0]?.[0] || article.created?.['date-parts']?.[0]?.[0] || '';
    const volume = article.volume || '';
    const issue = article.issue || '';
    const pages = article.page || '';
    const doi = article.DOI || '';
    
    document.getElementById('article-title').textContent = title;
    document.getElementById('article-authors').textContent = authors;
    document.getElementById('article-journal').textContent = journal;
    document.getElementById('article-date').textContent = year ? `${lang === 'zh' ? '出版年份' : 'Published'}: ${year}` : '';
    document.getElementById('article-doi').textContent = doi ? `DOI: ${doi}` : '';
    
    const onlineDate = article.deposited?.['date-time'] || article.created?.['date-time'];
    if (onlineDate) {
      const date = new Date(onlineDate);
      document.getElementById('online-date').textContent = date.toLocaleDateString();
    }
    
    generateCitation(currentFormat);
  }
  
  function generateCitation(format: string) {
    if (!currentArticle) return;
    
    const title = currentArticle.title?.[0] || '';
    const authors = currentArticle.author || [];
    const journal = currentArticle['container-title']?.[0] || '';
    const year = currentArticle.published?.['date-parts']?.[0]?.[0] || '';
    const volume = currentArticle.volume || '';
    const issue = currentArticle.issue || '';
    const pages = currentArticle.page || '';
    const doi = currentArticle.DOI || '';
    
    let citation = '';
    
    switch (format) {
      case 'apa':
        const apaAuthors = authors.slice(0, 7).map((a: any) => `${a.family}, ${a.given?.[0] || ''}.`).join(', ');
        citation = `${apaAuthors}${authors.length > 7 ? ', ...' : ''} (${year}). ${title}. ${journal}, ${volume}${issue ? `(${issue})` : ''}, ${pages}. https://doi.org/${doi}`;
        break;
      case 'mla':
        const mlaAuthors = authors.slice(0, 3).map((a: any, i: number) => i === 0 ? `${a.family}, ${a.given}.` : `${a.given} ${a.family}`).join(', ');
        citation = `${mlaAuthors}. "${title}." ${journal}, vol. ${volume}, no. ${issue}, ${year}, pp. ${pages}.`;
        break;
      case 'chicago':
        const chicagoAuthors = authors.slice(0, 3).map((a: any, i: number) => i === 0 ? `${a.family}, ${a.given}.` : `${a.given} ${a.family}`).join(', ');
        citation = `${chicagoAuthors}. "${title}." ${journal} ${volume}, no. ${issue} (${year}): ${pages}.`;
        break;
      case 'ieee':
        const ieeeAuthors = authors.slice(0, 6).map((a: any) => `${a.given?.[0] || ''}. ${a.family}`).join(', ');
        citation = `${ieeeAuthors}${authors.length > 6 ? ', et al.' : ''}, "${title}," ${journal}, vol. ${volume}, no. ${issue}, pp. ${pages}, ${year}.`;
        break;
      case 'vancouver':
        const vancouverAuthors = authors.slice(0, 6).map((a: any) => `${a.family} ${a.given?.[0] || ''}`).join(', ');
        citation = `${vancouverAuthors}${authors.length > 6 ? ', et al.' : ''}. ${title}. ${journal}. ${year};${volume}(${issue}):${pages}.`;
        break;
      case 'gbt7714':
        const gbtAuthors = authors.slice(0, 3).map((a: any) => `${a.family}`).join(', ');
        citation = `${gbtAuthors}. ${title}[J]. ${journal}, ${year}, ${volume}(${issue}): ${pages}.`;
        break;
      case 'bibtex':
        const key = `${authors[0]?.family || 'unknown'}${year}`.toLowerCase();
        const bibtexAuthors = authors.map((a: any) => `${a.family}, ${a.given}`).join(' and ');
        citation = `@article{${key},
  author = {${bibtexAuthors}},
  title = {${title}},
  journal = {${journal}},
  year = {${year}},
  volume = {${volume}},
  number = {${issue}},
  pages = {${pages}},
  doi = {${doi}}
}`;
        break;
    }
    
    document.getElementById('citation-text').textContent = citation;
  }
  
  document.querySelectorAll('.format-tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.format-tab').forEach(t => t.classList.remove('active'));
      tab.classList.add('active');
      currentFormat = tab.getAttribute('data-format') || 'apa';
      generateCitation(currentFormat);
    });
  });
  
  document.getElementById('copy-citation')?.addEventListener('click', () => {
    const text = document.getElementById('citation-text')?.textContent;
    if (text) navigator.clipboard.writeText(text);
  });
  
  // BibTeX Generator
  document.getElementById('generate-bibtex')?.addEventListener('click', () => {
    const type = (document.getElementById('bibtex-type') as HTMLSelectElement)?.value || 'article';
    const key = (document.getElementById('bibtex-key') as HTMLInputElement)?.value || 'key';
    const authors = (document.getElementById('bibtex-authors') as HTMLTextAreaElement)?.value || '';
    const title = (document.getElementById('bibtex-title') as HTMLInputElement)?.value || '';
    const journal = (document.getElementById('bibtex-journal') as HTMLInputElement)?.value || '';
    const year = (document.getElementById('bibtex-year') as HTMLInputElement)?.value || '';
    const volume = (document.getElementById('bibtex-volume') as HTMLInputElement)?.value || '';
    const number = (document.getElementById('bibtex-number') as HTMLInputElement)?.value || '';
    const pages = (document.getElementById('bibtex-pages') as HTMLInputElement)?.value || '';
    const doi = (document.getElementById('bibtex-doi') as HTMLInputElement)?.value || '';
    
    const authorList = authors.split('\n').filter(a => a.trim()).join(' and ');
    
    let bibtex = `@${type}{${key},\n`;
    if (authorList) bibtex += `  author = {${authorList}},\n`;
    if (title) bibtex += `  title = {${title}},\n`;
    if (journal) bibtex += `  journal = {${journal}},\n`;
    if (year) bibtex += `  year = {${year}},\n`;
    if (volume) bibtex += `  volume = {${volume}},\n`;
    if (number) bibtex += `  number = {${number}},\n`;
    if (pages) bibtex += `  pages = {${pages}},\n`;
    if (doi) bibtex += `  doi = {${doi}},\n`;
    bibtex = bibtex.slice(0, -2) + '\n}';
    
    document.getElementById('bibtex-code').textContent = bibtex;
    document.getElementById('bibtex-output')?.classList.remove('hidden');
  });
  
  document.getElementById('copy-bibtex')?.addEventListener('click', () => {
    const text = document.getElementById('bibtex-code')?.textContent;
    if (text) navigator.clipboard.writeText(text);
  });
  
  // LaTeX Editor
  document.querySelectorAll('.symbol-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const latex = btn.getAttribute('data-latex') || '';
      const input = document.getElementById('latex-input') as HTMLTextAreaElement;
      if (input) {
        const start = input.selectionStart;
        const end = input.selectionEnd;
        input.value = input.value.substring(0, start) + latex + input.value.substring(end);
        input.focus();
        input.setSelectionRange(start + latex.length, start + latex.length);
      }
    });
  });
  
  document.getElementById('render-latex')?.addEventListener('click', () => {
    const latex = (document.getElementById('latex-input') as HTMLTextAreaElement)?.value;
    const preview = document.getElementById('latex-preview');
    if (latex && preview) {
      // Use MathJax or KaTeX for rendering (simplified here)
      preview.innerHTML = `<span style="font-size: 1.5em; font-family: serif;">${latex}</span>`;
    }
  });
  
  // Translation
  document.getElementById('swap-langs')?.addEventListener('click', () => {
    const sourceLang = document.getElementById('source-lang') as HTMLSelectElement;
    const targetLang = document.getElementById('target-lang') as HTMLSelectElement;
    const temp = sourceLang.value;
    sourceLang.value = targetLang.value;
    targetLang.value = temp;
  });
  
  document.getElementById('do-translate')?.addEventListener('click', async () => {
    const text = (document.getElementById('source-text') as HTMLTextAreaElement)?.value;
    const sourceLang = (document.getElementById('source-lang') as HTMLSelectElement)?.value;
    const targetLang = (document.getElementById('target-lang') as HTMLSelectElement)?.value;
    
    if (!text) return;
    
    try {
      const response = await fetch(`${API_BASE}/api/translate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text, source: sourceLang, target: targetLang })
      });
      const result = await response.json();
      
      const targetText = document.getElementById('target-text') as HTMLTextAreaElement;
      if (targetText && result.translation) {
        targetText.value = result.translation;
      }
    } catch (error) {
      console.error('Translation error:', error);
    }
  });
  
  // Keywords Extractor
  document.getElementById('extract-keywords')?.addEventListener('click', async () => {
    const text = (document.getElementById('keyword-text') as HTMLTextAreaElement)?.value;
    const count = (document.getElementById('keyword-count') as HTMLSelectElement)?.value || '10';
    
    if (!text) return;
    
    try {
      const response = await fetch(`${API_BASE}/api/keywords`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text, count: parseInt(count) })
      });
      const result = await response.json();
      
      const cloud = document.getElementById('keywords-cloud');
      if (cloud && result.keywords) {
        cloud.innerHTML = result.keywords.map((k: string) => `<span class="keyword-tag">${k}</span>`).join('');
        document.getElementById('keywords-result')?.classList.remove('hidden');
      }
    } catch (error) {
      console.error('Keywords extraction error:', error);
    }
  });
</script>
