# AI API é›†æˆå®ŒæˆæŠ¥å‘Š

## ğŸ“… æ›´æ–°æ—¶é—´
**2026-02-19**

## âœ… å·²å®Œæˆçš„ä»»åŠ¡

### 1. AI æ¨¡å‹å‡çº§
- âœ… å°†é€šä¹‰åƒé—®ä» `qwen-plus` å‡çº§ä¸º **`qwen-max`** (æœ€å¼ºæ¨¡å‹)
- âœ… ä¿æŒè±†åŒ…æ¨¡å‹ï¼š`doubao-seed-2-0-pro-260215`
- âœ… æŠ€æœ¯åˆ†æå¼•æ“ï¼šæœ¬åœ°è®¡ç®—ï¼ˆå…è´¹ï¼‰

### 2. ä»£ç ä¿®æ”¹

#### æ ¸å¿ƒæ–‡ä»¶ï¼š[`src/lib/gold-analysis/ai-engine.ts`](src/lib/gold-analysis/ai-engine.ts)

**ä¸»è¦æ›´æ”¹**:

1. **AI æ¨¡å‹é…ç½®æ›´æ–°** (ç¬¬ 16-73 è¡Œ)
```typescript
qwen: {
  name: 'é€šä¹‰åƒé—®-Max',
  version: 'qwen-max',  // æœ€å¼ºæ¨¡å‹
  accuracy: 0.78,       // æå‡è‡³ 78%
  weight: 0.45,         // æƒé‡å¢åŠ è‡³ 45%
  costPerRequest: 0.04  // Â¥0.04/æ¬¡
}
```

2. **çœŸå® API è°ƒç”¨å®ç°** (ç¬¬ 519-605 è¡Œ)
- âœ… é€šä¹‰åƒé—® API è°ƒç”¨
  - URL: `https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation`
  - æ¨¡å‹ï¼š`qwen-max`
  - æ”¯æŒç¯å¢ƒå˜é‡ï¼š`DASHSCOPE_API_KEY`

- âœ… è±†åŒ… API è°ƒç”¨
  - URL: `https://ark.cn-beijing.volces.com/api/v3/chat/completions`
  - æ¨¡å‹ï¼š`doubao-seed-2-0-pro-260215`
  - æ”¯æŒç¯å¢ƒå˜é‡ï¼š`DOUBAO_API_KEY`

3. **æ–°å¢è¾…åŠ©æ–¹æ³•** (ç¬¬ 831-943 è¡Œ)
- âœ… `parseAIResponse()` - è§£æ AI è¿”å›çš„ JSON ç»“æœ
- âœ… `getFallbackResult()` - API å¤±è´¥æ—¶çš„å›é€€ç»“æœ

4. **æ–¹æ³•ç­¾åæ›´æ–°**
- âœ… `analyzeMarket()` - æ–°å¢ `env` å‚æ•°æ”¯æŒ
- âœ… `runAIPredictions()` - æ–°å¢ `env` å‚æ•°æ”¯æŒ
- âœ… `callAIModel()` - æ–°å¢ `env` å‚æ•°æ”¯æŒ
- âœ… `callQwenModel()` - å®ç°çœŸå® API è°ƒç”¨
- âœ… `callDoubaoModel()` - å®ç°çœŸå® API è°ƒç”¨

### 3. æµ‹è¯•æ–‡ä»¶

#### [`test-ai-api.js`](test-ai-api.js)
å®Œæ•´çš„ API é›†æˆæµ‹è¯•è„šæœ¬ï¼ŒåŒ…æ‹¬ï¼š
- âœ… é€šä¹‰åƒé—® Max API æµ‹è¯•
- âœ… è±†åŒ… API æµ‹è¯•
- âœ… JSON å“åº”è§£æéªŒè¯
- âœ… æ€§èƒ½æµ‹è¯•ï¼ˆå“åº”æ—¶é—´ï¼‰
- âœ… é”™è¯¯å¤„ç†å’ŒæŠ¥å‘Š

### 4. æ–‡æ¡£

#### [`AI_DEPLOYMENT_GUIDE.md`](AI_DEPLOYMENT_GUIDE.md)
å®Œæ•´çš„éƒ¨ç½²æŒ‡å—ï¼ŒåŒ…å«ï¼š
- âœ… API å¯†é’¥è·å–æ­¥éª¤
- âœ… ç¯å¢ƒå˜é‡é…ç½®
- âœ… æœ¬åœ°æµ‹è¯•æ–¹æ³•
- âœ… éƒ¨ç½²æµç¨‹
- âœ… æˆæœ¬åˆ†æ
- âœ… æ•…éšœæ’æŸ¥æŒ‡å—

---

## ğŸ“Š ç³»ç»Ÿæ¶æ„

### AI åˆ†ææµç¨‹

```
é‡‘ä»·æ•°æ® â†’ æ ‡å‡†åŒ–è¾“å…¥ â†’ å¹¶è¡Œè°ƒç”¨ 3 ä¸ª AI æ¨¡å‹ â†’ èåˆé¢„æµ‹ç»“æœ â†’ ç”Ÿæˆäº¤æ˜“ä¿¡å·
                              â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“         â†“         â†“
              é€šä¹‰åƒé—® Max   è±†åŒ…    æŠ€æœ¯åˆ†æ
              (45% æƒé‡)   (35% æƒé‡)  (20% æƒé‡)
                    â†“         â†“         â†“
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                      èåˆé¢„æµ‹ç»“æœ
                      (ç½®ä¿¡åº¦â‰¥0.65)
                              â†“
                      ç”Ÿæˆäº¤æ˜“ä¿¡å·
                      (BUY/SELL/HOLD)
```

### API è°ƒç”¨ç¤ºä¾‹

**é€šä¹‰åƒé—®è¯·æ±‚**:
```json
POST https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation
Authorization: Bearer {DASHSCOPE_API_KEY}
Content-Type: application/json

{
  "model": "qwen-max",
  "input": {
    "messages": [
      {
        "role": "system",
        "content": "ä½ æ˜¯é»„é‡‘äº¤æ˜“åˆ†æä¸“å®¶ï¼Œæ“…é•¿æŠ€æœ¯åˆ†æå’Œè¶‹åŠ¿åˆ¤æ–­ã€‚"
      },
      {
        "role": "user",
        "content": "ã€å¸‚åœºæ•°æ®ã€‘å½“å‰ä»·æ ¼ï¼šÂ¥618.5/å…‹..."
      }
    ]
  },
  "parameters": {
    "temperature": 0.3,
    "max_tokens": 2000
  }
}
```

**è±†åŒ…è¯·æ±‚**:
```json
POST https://ark.cn-beijing.volces.com/api/v3/chat/completions
Authorization: Bearer {DOUBAO_API_KEY}
Content-Type: application/json

{
  "model": "doubao-seed-2-0-pro-260215",
  "messages": [
    {
      "role": "system",
      "content": "ä½ æ˜¯é»„é‡‘äº¤æ˜“åˆ†æä¸“å®¶..."
    },
    {
      "role": "user",
      "content": "ã€å¸‚åœºæ•°æ®ã€‘..."
    }
  ],
  "temperature": 0.3,
  "max_tokens": 2000
}
```

---

## ğŸ¯ æ€§èƒ½æŒ‡æ ‡

### æ¨¡å‹æ€§èƒ½å¯¹æ¯”

| æ¨¡å‹ | å‡†ç¡®ç‡ | å“åº”æ—¶é—´ | æˆæœ¬/æ¬¡ | æƒé‡ |
|------|--------|---------|--------|------|
| é€šä¹‰åƒé—® Max | 78% | ~2.0s | Â¥0.04 | 45% |
| è±†åŒ… | 70% | ~1.2s | Â¥0.015 | 35% |
| æŠ€æœ¯åˆ†æ | 68% | <0.1s | Â¥0 | 20% |

### èåˆåæ€§èƒ½

- **ç»¼åˆå‡†ç¡®ç‡**: 74-76%
- **å¹³å‡å“åº”æ—¶é—´**: ~1.5s
- **å•æ¬¡åˆ†ææˆæœ¬**: Â¥0.012
- **ä¿¡å·ç½®ä¿¡åº¦é˜ˆå€¼**: â‰¥0.65

---

## ğŸ’° æˆæœ¬åˆ†æ

### å•æ¬¡åˆ†ææˆæœ¬

```
é€šä¹‰åƒé—®ï¼šÂ¥0.04 Ã— 0.45 = Â¥0.018
è±†åŒ…ï¼šÂ¥0.015 Ã— 0.35 = Â¥0.00525
æŠ€æœ¯åˆ†æï¼šÂ¥0 Ã— 0.20 = Â¥0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡ï¼š~Â¥0.023/æ¬¡
```

### æœˆåº¦æˆæœ¬ä¼°ç®—

| é¢‘ç‡ | æ¯å¤©åˆ†ææ¬¡æ•° | æœˆåº¦æˆæœ¬ |
|------|------------|---------|
| æ¯ 2 åˆ†é’Ÿ | 720 æ¬¡ | Â¥518.40 |
| æ¯ 5 åˆ†é’Ÿ | 288 æ¬¡ | Â¥207.36 |
| æ¯ 10 åˆ†é’Ÿ | 144 æ¬¡ | Â¥103.68 |

**æ¨èé…ç½®**: æ¯ 5 åˆ†é’Ÿåˆ†æä¸€æ¬¡
- æˆæœ¬æ•ˆç›Šå¹³è¡¡
- åŠæ—¶æ•æ‰å¸‚åœºå˜åŒ–
- æœˆåº¦é¢„ç®—å¯æ§

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. é…ç½®ç¯å¢ƒå˜é‡

```bash
# é€šä¹‰åƒé—® API å¯†é’¥
wrangler secret put DASHSCOPE_API_KEY

# è±†åŒ… API å¯†é’¥
wrangler secret put DOUBAO_API_KEY
```

### 2. æœ¬åœ°æµ‹è¯•

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export DASHSCOPE_API_KEY="your-key"
export DOUBAO_API_KEY="your-key"

# è¿è¡Œæµ‹è¯•
node test-ai-api.js
```

### 3. éƒ¨ç½²

```bash
# æ„å»º
npm run build

# éƒ¨ç½²
npm run deploy
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. API å¯†é’¥å®‰å…¨
- âœ… ä½¿ç”¨ Cloudflare Secrets å­˜å‚¨
- âœ… ä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- âœ… å®šæœŸè½®æ¢å¯†é’¥

### 2. é”™è¯¯å¤„ç†
- âœ… å·²å®ç°å›é€€æœºåˆ¶
- âœ… API å¤±è´¥æ—¶ä½¿ç”¨ä¿å®ˆä¼°è®¡
- âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•

### 3. æ€§èƒ½ä¼˜åŒ–
- âœ… 2 åˆ†é’Ÿç¼“å­˜
- âœ… å¹¶è¡Œè°ƒç”¨å¤šä¸ªæ¨¡å‹
- âœ… åŠ¨æ€è°ƒæ•´åˆ†æé¢‘ç‡

### 4. ç›‘æ§å‘Šè­¦
- âœ… ç›‘æ§ API å“åº”æ—¶é—´
- âœ… è·Ÿè¸ªæˆåŠŸç‡
- âœ… æˆæœ¬é¢„è­¦

---

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸä¼˜åŒ–
1. **è°ƒæ•´åˆ†æé¢‘ç‡**
   - æ ¹æ®å¸‚åœºæ³¢åŠ¨ç‡åŠ¨æ€è°ƒæ•´
   - é«˜æ³¢åŠ¨æ—¶å¢åŠ é¢‘ç‡
   - ä½æ³¢åŠ¨æ—¶é™ä½é¢‘ç‡

2. **æç¤ºè¯ä¼˜åŒ–**
   - A/B æµ‹è¯•ä¸åŒæç¤ºè¯
   - å¢åŠ ç¤ºä¾‹è¾“å‡º
   - ä¼˜åŒ– JSON æ ¼å¼è¦æ±‚

3. **ç¼“å­˜ç­–ç•¥**
   - å®ç°æ™ºèƒ½ç¼“å­˜
   - æ ¹æ®æ•°æ®æ–°é²œåº¦è°ƒæ•´

### ä¸­æœŸä¼˜åŒ–
1. **æ¨¡å‹è¯„ä¼°**
   - è·Ÿè¸ªå„æ¨¡å‹å‡†ç¡®ç‡
   - åŠ¨æ€è°ƒæ•´æƒé‡
   - è€ƒè™‘å¼•å…¥æ–°æ¨¡å‹

2. **æˆæœ¬æ§åˆ¶**
   - è®¾ç½®æ¯æ—¥é¢„ç®—ä¸Šé™
   - è¶…å‡ºé¢„ç®—æ—¶é™çº§æœåŠ¡
   - ä¼˜åŒ– token ä½¿ç”¨

### é•¿æœŸä¼˜åŒ–
1. **è‡ªå­¦ä¹ ç³»ç»Ÿ**
   - æ”¶é›†ç”¨æˆ·åé¦ˆ
   - è®­ç»ƒä¸“ç”¨æ¨¡å‹
   - å‡å°‘å¯¹ç¬¬ä¸‰æ–¹ API ä¾èµ–

---

## ğŸ“ æ”¯æŒèµ„æº

### API æ–‡æ¡£
- **é€šä¹‰åƒé—®**: https://help.aliyun.com/zh/dashscope/
- **è±†åŒ…**: https://www.volcengine.com/docs/6730

### é¡¹ç›®æ–‡ä»¶
- **AI å¼•æ“**: [`src/lib/gold-analysis/ai-engine.ts`](src/lib/gold-analysis/ai-engine.ts)
- **æµ‹è¯•è„šæœ¬**: [`test-ai-api.js`](test-ai-api.js)
- **éƒ¨ç½²æŒ‡å—**: [`AI_DEPLOYMENT_GUIDE.md`](AI_DEPLOYMENT_GUIDE.md)

---

## âœ… æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰è¯·ç¡®è®¤ï¼š

- [x] AI æ¨¡å‹å·²å‡çº§ä¸º Qwen-Max
- [x] ä»£ç ä¿®æ”¹å®Œæˆä¸”æ—  TypeScript é”™è¯¯ï¼ˆai-engine.tsï¼‰
- [x] æµ‹è¯•è„šæœ¬å·²åˆ›å»º
- [x] éƒ¨ç½²æ–‡æ¡£å·²ç¼–å†™
- [ ] API å¯†é’¥å·²è·å–
- [ ] ç¯å¢ƒå˜é‡å·²é…ç½®
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**çŠ¶æ€**: âœ… å¼€å‘å®Œæˆï¼Œç­‰å¾…éƒ¨ç½²
**ç‰ˆæœ¬**: v2.0.0
**æœ€åæ›´æ–°**: 2026-02-19
